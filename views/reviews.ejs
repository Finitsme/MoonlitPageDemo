<%- include('partials/header', { title: title }) %> <%-
include('partials/navbar', { user: locals.user }) %>

<main class="container py-5">
  <div class="row">
    <div class="col-lg-10 offset-lg-1">
      <h1 class="mb-4">รีวิวสำหรับ: <%= bookTitle %></h1>
      <p class="lead text-muted">
        เราได้สุ่มรีวิว <%= reviews.length %> รายการจากผู้ใช้งานคนอื่นมาแสดง
      </p>

      <a href="/book?q=<%= bookId %>" class="btn btn-warning mb-4">
        <i class="fas fa-book-open me-2"></i> ดูข้อมูลหนังสือเล่มนี้
      </a>

      <% if (reviews.length === 0) { %>
      <div class="alert alert-info text-center mt-4">
        ยังไม่มีรีวิวสำหรับหนังสือเล่มนี้
      </div>
      <% } else { %> <% reviews.forEach(review => { %>
      <div class="card mb-3 shadow-sm review-card">
        <div class="card-body">
          <h5 class="card-title mb-1">
            <i class="fas fa-user-circle me-2"></i>
            <%= review.username_display || 'ผู้ใช้งาน MoonlitPage' %>
          </h5>
          <p class="text-muted small mb-3">
            โพสต์เมื่อ: <%= new
            Date(review.created_at).toLocaleDateString('th-TH') %>
          </p>
          <p class="card-text review-content">"<%= review.content %>"</p>
        </div>
      </div>
      <% }); %> <% } %>

      <button
        class="btn btn-primary mt-4"
        data-bs-toggle="modal"
        data-bs-target="#postReviewModal"
      >
        <i class="fas fa-pen me-2"></i> เขียนรีวิวหนังสือเล่มนี้
      </button>
    </div>
  </div>
</main>

<div class="modal fade" id="postReviewModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">รีวิว: <%= bookTitle %></h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <form action="/review/post" method="POST">
        <div class="modal-body">
          <input type="hidden" name="book_id" value="<%= bookId %>" />
          <div class="mb-3">
            <label class="form-label"
              >ความคิดเห็นของคุณ (สูงสุด 500 ตัวอักษร)</label
            >
            <textarea
              name="content"
              class="form-control"
              rows="4"
              maxlength="500"
              required
            ></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            ยกเลิก
          </button>
          <button type="submit" class="btn btn-primary">โพสต์รีวิว</button>
        </div>
      </form>
    </div>
  </div>
</div>

<%- include('partials/footer') %>
